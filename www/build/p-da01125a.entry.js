import{r as i,d as t,B as s,h as n,c as o}from"./p-a77c936b.js";const e=class{constructor(s){i(this,s),this.fireenjinFetch=t(this,"fireenjinFetch",7),this.fireenjinReset=t(this,"fireenjinReset",7),this.fireenjinSubmit=t(this,"fireenjinSubmit",7),this.fireenjinValidation=t(this,"fireenjinValidation",7),this.componentIsLoaded=!1,this.formData={},this.submitButton="Save",this.submitButtonColor="primary",this.submitButtonFill="solid",this.resetButton="Cancel",this.resetButtonColor="dark",this.resetButtonFill="clear",this.hideControls=!1,this.disableLoader=!1,this.loading=!1,this.disableEnterButton=!1,this.disableReset=!1,this.confirmExit=!1,this.hasChanged=!1,this.method="post"}handleKeyDown(i){"Enter"===i.key&&this.disableEnterButton&&i.preventDefault()}async onInput(i){var t;i&&i.target&&i.target.name&&!i.target.name.startsWith("ion-")&&(this.setByPath(this.formData,i.target.name,(null===(t=this.filterData)||void 0===t?void 0:t.length)?await this.setFilteredValue(i.target.name,i.target.value):i.target.value),this.componentIsLoaded&&!this.hasChanged&&(this.hasChanged=!0))}async onSuccess(i){var t,s,n,o,e;this.fetch&&[this.endpoint,this.fetch].includes(null===(t=null==i?void 0:i.detail)||void 0===t?void 0:t.endpoint)&&"fireenjinFetch"===(null===(n=null===(s=null==i?void 0:i.detail)||void 0===s?void 0:s.event)||void 0===n?void 0:n.type)&&await this.setFormData(this.fetchKey?this.fetchKey.split(".").reduce(((i,t)=>i[t]),i.detail.data):null===(o=null==i?void 0:i.detail)||void 0===o?void 0:o.data),[this.endpoint,this.fetch].includes(null===(e=null==i?void 0:i.detail)||void 0===e?void 0:e.endpoint)&&(this.loading=!1)}async onError(i){var t;this.endpoint===(null===(t=null==i?void 0:i.detail)||void 0===t?void 0:t.endpoint)&&(this.loading=!1)}async submit(i,t={manual:!1}){var s;i&&i.preventDefault(),await this.checkFormValidity(),this.loading=!this.disableLoader;const n=this.beforeSubmit&&"function"==typeof this.beforeSubmit?await this.beforeSubmit(this.formData,t):this.formData;console.log(this.filterData),this.fireenjinSubmit.emit({event:i,id:this.documentId,endpoint:this.endpoint,data:(null===(s=this.filterData)||void 0===s?void 0:s.length)?await this.filterFormData(n):n,name:this.name}),this.hasChanged=!1}async reset(i){if(!i)return this.formEl.reset(),!1;this.disableReset?i.preventDefault():(this.formData={},this.hasChanged=!1),this.fireenjinReset.emit({event:i,id:this.documentId,endpoint:this.endpoint,data:this.formData,name:this.name})}async checkFormValidity(i=!0){let t=!0;const s=[].slice.call(this.formEl.querySelectorAll("[value]"));for(const n of s)try{await n.checkValidity(i?null:{validationClassOptions:{ignoreInvalid:!0}})||(t&&i&&await n.reportValidity(),t=!1)}catch(i){console.log(`${null==n?void 0:n.name} input not able to be validated!`)}return t}async reportFormValidity(){const i=await this.checkFormValidity(!1);this.fireenjinValidation.emit({event,isValid:i,name:this.name}),this.submitButtonEl&&(this.submitButtonEl.disabled=!i)}async setFormData(i){this.formEl.querySelectorAll("[data-fill]").forEach((t=>{var s,n;const o=(null===(n=null===(s=t.dataset)||void 0===s?void 0:s.fill)||void 0===n?void 0:n.length)>0?t.dataset.fill:t.name;t.value=this.getByPath(i,o)})),this.formData=await this.mapFormData(this.fetchDataMap,i||{})}async setFilteredValue(i,t){var s,n;let o=t;for(const e of"string"==typeof this.filterData?this.filterData.split(","):this.filterData){if("function"!=typeof e)continue;const h=null===(n=null===(s=Object.getOwnPropertyDescriptors(e))||void 0===s?void 0:s.name)||void 0===n?void 0:n.value;h&&h===i&&(o=await e(t))}return o}async mapFormData(i,t){let s=t||{};if(i){const n=Object.keys(i);for(const o of n)i[o]?s[i[o]]=t[o]:s=Object.assign(Object.assign({},s),t[o])}return s}async filterFormData(i){var t,s;let n={};for(const o of"string"==typeof this.filterData?this.filterData.split(","):this.filterData)if("string"==typeof o)n[o]=i[o];else if("function"==typeof o){const e=null===(s=null===(t=Object.getOwnPropertyDescriptors(o))||void 0===t?void 0:t.name)||void 0===s?void 0:s.value;n[e]=await o(i[e])}return n}pick(i,t){const s={};for(const n of t)(null==i?void 0:i[n])&&(s[n]=i[n]);return s}getByPath(i,t){for(var s=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),n=0,o=s.length;n<o;++n){var e=s[n];if(!(e in i))return;i=i[e]}return i}setByPath(i,t,s){const n=t.split("."),o=n.length;for(let t=0;t<o-1;t++){const s=n[t];i[s]||(i[s]={}),i=i[s]}i[n[o-1]]=s}componentDidLoad(){(null==s?void 0:s.isBrowser)&&(setTimeout((()=>{this.componentIsLoaded=!0}),2e3),this.fetch&&(this.disableLoader||(this.loading=!0),this.fireenjinFetch.emit({endpoint:"string"==typeof this.fetch?this.fetch:this.endpoint,name:this.name||null,dataPropsMap:this.fetchDataMap||null,method:"get",params:Object.assign(Object.assign({},this.fetchParams?this.fetchParams:{}),{id:this.documentId})})),this.formData&&this.setFormData(this.formData))}render(){return n("form",{ref:i=>this.formEl=i,name:this.name,id:this.name,action:this.action?this.action:`/${this.endpoint}`,method:this.method,onReset:i=>this.reset(i),onSubmit:i=>this.submit(i),class:{"is-loading":this.loading}},n("slot",null),!this.hideControls&&n("ion-grid",{class:"form-controls"},n("ion-row",null,n("ion-col",null,this.resetButton?n("ion-button",{ref:i=>this.resetButtonEl=i,type:"reset",fill:this.resetButtonFill,color:this.resetButtonColor,innerHTML:this.resetButton}):null),n("ion-col",null,this.submitButton?n("ion-button",{ref:i=>this.submitButtonEl=i,type:"submit",color:this.submitButtonColor,fill:this.submitButtonFill,innerHTML:this.submitButton}):null))))}get fireenjinFormEl(){return o(this)}};e.style="fireenjin-form{display:block}fireenjin-form .form-controls{opacity:1;pointer-events:all;transition:all ease-out 0.4s}fireenjin-form .form-controls ion-col:last-of-type{display:flex;flex-direction:row;justify-content:flex-end}fireenjin-form .is-hidden{opacity:0;pointer-events:none;height:0px}";export{e as fireenjin_form}
import{r as i,d as t,B as s,h as n,w as e,e as o,c as l,H as r,f as h}from"./p-a77c936b.js";import{D as a}from"./p-0506e1ca.js";import{g as c,c as d}from"./p-84bd14d5.js";import{a as u,p,g as f}from"./p-db955081.js";import{s as g}from"./p-7d8427eb.js";import{c as m}from"./p-2bde1599.js";import"./p-4e9b4087.js";import"./p-9887b817.js";const v=class{constructor(s){i(this,s),this.fireenjinFetch=t(this,"fireenjinFetch",7),this.disablePageCheck=!1,this.disableFetch=!1,this.display="list",this.page=0,this.results=[],this.loadingSpinner="bubbles",this.loadingText="Loading more data...",this.name="pagination",this.disableVirtualScroll=!1,this.removeDuplicates=!1,this.paramData={}}onQuery(){this.infiniteScrollEl.disabled=!1,this.results=[],this.getResults({page:0})}onOrderBy(){this.results=[],this.infiniteScrollEl.disabled=!1,this.getResults({page:0})}onDisplay(){this.infiniteScrollEl.disabled=!1,setTimeout((async()=>{window.dispatchEvent(new window.Event("resize"))}),2e3)}async onSuccess(i){if(i.detail.name===this.name){let t=[];try{t=this.resultsKey.split(".").reduce(((i,t)=>i[t]),i.detail.data)}catch(t){console.log("Error getting results",i.detail,this.resultsKey)}try{0===this.page&&(this.results=[]),this.page=this.pageKey?this.pageKey.split(".").reduce(((i,t)=>i[t]),i.detail.data):this.page+1,await this.addResults(t)}catch(i){console.log("Error updating results!")}await this.infiniteScrollEl.complete(),(!(null==t?void 0:t.length)||this.pageCountKey&&this.pageKey&&this.pageKey.split(".").reduce(((i,t)=>i[t]),i.detail.data)===this.pageCountKey.split(".").reduce(((i,t)=>i[t]),i.detail.data))&&(this.infiniteScrollEl.disabled=!0),this.disableVirtualScroll||(await this.virtualScrollEl.checkEnd(),setTimeout((()=>{window.dispatchEvent(new window.Event("resize"))}),200))}}onInfiniteScroll(){this.getResults({next:!0})}onResize(){var i,t;if(!this.disableVirtualScroll)if("list"===this.display&&(null===(i=this.virtualScrollEl)||void 0===i?void 0:i.querySelector("ion-item")))this.approxItemHeight=this.virtualScrollEl.querySelector("ion-item").offsetHeight;else if("grid"===this.display&&(null===(t=this.virtualScrollEl)||void 0===t?void 0:t.querySelectorAll("ion-col"))){let i,t;const s=this.virtualScrollEl.querySelectorAll("ion-col");for(i=0;i<s.length;i++){const n=s[i];if(t&&n.offsetTop!==t.offsetTop)break;t=n}t&&t.firstChild&&(this.approxItemHeight=t.firstChild.scrollHeight/i+18)}}async clearParamData(i){if(i&&this.paramData[i]){const t=this.paramData;delete t[i],this.paramData=t}else i||(this.paramData={});return this.infiniteScrollEl.disabled=!1,this.paramData}async addResults(i=[]){if(this.removeDuplicates){const t=i.map((i=>i.id));this.results=[...this.results.filter((i=>!t.includes(i.id))),...i]}else this.results=[...this.results,...i];this.infiniteScrollEl.disabled=!1}async clearResults(){this.page=0,this.results=[],this.infiniteScrollEl.disabled=!1}async getResults(i={}){var t,s,n;(this.disablePageCheck||(null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.pathname)===this.initailizedOnPath)&&((i.page||0===i.page)&&(this.page=i.page),i.next&&(this.page=this.page+1),this.paramData=Object.assign(Object.assign(Object.assign({},this.paramData),{limit:i.limit?i.limit:this.limit,orderBy:this.orderBy,orderDirection:this.orderDirection,page:this.page}),(null==i?void 0:i.paramData)?i.paramData:{}),(this.query||""===this.query)&&(this.paramData.query=this.query),0===this.page&&(this.paramData.next=null,this.paramData.back=null),i.next&&(null===(s=this.results)||void 0===s?void 0:s.length)&&(null===(n=this.results[this.results.length-1])||void 0===n?void 0:n.id)&&(this.paramData.next=this.results[this.results.length-1].id),this.fireenjinFetch.emit({name:this.name,endpoint:this.endpoint,dataPropsMap:this.dataPropsMap?this.dataPropsMap:null,disableFetch:this.disableFetch,params:Object.assign(Object.assign({},this.fetchParams?this.fetchParams:{}),{data:Object.assign(Object.assign({},this.fetchData?this.fetchData:{}),this.paramData)})}))}componentWillLoad(){(null==s?void 0:s.isBrowser)&&this.collection&&(this.resultsKey=this.resultsKey?this.resultsKey:`${this.collection}.results`,this.pageKey=this.pageKey?this.pageKey:`${this.collection}.page`,this.pageCountKey=this.pageCountKey?this.pageCountKey:`${this.collection}.pageCount`,this.resultCountKey=this.resultCountKey?this.resultCountKey:`${this.collection}.resultCount`,this.name=this.name?this.name:`${this.collection}Pagination`)}componentDidLoad(){var i,t;(null==s?void 0:s.isBrowser)&&((null===(i=null===window||void 0===window?void 0:window.location)||void 0===i?void 0:i.pathname)&&(this.initailizedOnPath=window.location.pathname),this.disableVirtualScroll||(window.dispatchEvent(new window.Event("resize")),this.resizeInterval=setInterval((()=>{window.dispatchEvent(new window.Event("resize"))}),3e3)),(null===(t=this.results)||void 0===t?void 0:t.length)||this.getResults())}disconnectedCallback(){this.disableVirtualScroll||clearInterval(this.resizeInterval)}renderResults(){return"grid"===this.display?n("ion-grid",null,n("ion-row",null,this.results.map((i=>"string"==typeof this.gridEl({result:i},null,null)?n("ion-col",{innerHTML:this.gridEl({result:i},null,null)}):n("ion-col",null,this.gridEl({result:i},null,null)))))):this.listEl?n("ion-card",null,n("ion-list",null,this.results.map((i=>"string"==typeof this.listEl({result:i},null,null)?n("div",{innerHTML:this.listEl({result:i},null,null)}):this.listEl({result:i},null,null))))):this.results.map(((i,t)=>this.renderItem(i,t)))}render(){return n("div",{class:"pagination"},this.disableVirtualScroll?n("div",null,this.renderResults()):n("ion-virtual-scroll",{items:this.results,approxItemHeight:this.approxItemHeight,renderItem:this.renderItem,ref:i=>this.virtualScrollEl=i},(this.listEl||this.gridEl)&&this.renderResults()),n("ion-infinite-scroll",{style:{display:"block"},ref:i=>this.infiniteScrollEl=i},n("ion-infinite-scroll-content",{"loading-spinner":this.loadingSpinner,"loading-text":this.loadingText})))}static get watchers(){return{query:["onQuery"],orderBy:["onOrderBy"],display:["onDisplay"]}}};(function(i,t,s,n){var e,o=arguments.length,l=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(i,t,s,n);else for(var r=i.length-1;r>=0;r--)(e=i[r])&&(l=(o<3?e(l):o>3?e(t,s,l):e(t,s))||l);o>3&&l&&Object.defineProperty(t,s,l)})([a(1e3)],v.prototype,"onQuery",null),v.style="";const b=class{constructor(s){i(this,s),this.ionInfinite=t(this,"ionInfinite",7),this.thrPx=0,this.thrPc=0,this.didFire=!1,this.isBusy=!1,this.isLoading=!1,this.threshold="15%",this.disabled=!1,this.position="bottom",this.onScroll=()=>{const i=this.scrollEl;if(!i||!this.canStart())return 1;const t=this.el.offsetHeight;if(0===t)return 2;const s=i.scrollTop,n=i.offsetHeight,e=0!==this.thrPc?n*this.thrPc:this.thrPx;if(("bottom"===this.position?i.scrollHeight-t-s-e-n:s-t-e)<0){if(!this.didFire)return this.isLoading=!0,this.didFire=!0,this.ionInfinite.emit(),3}else this.didFire=!1;return 4}}thresholdChanged(){const i=this.threshold;i.lastIndexOf("%")>-1?(this.thrPx=0,this.thrPc=parseFloat(i)/100):(this.thrPx=parseFloat(i),this.thrPc=0)}disabledChanged(){const i=this.disabled;i&&(this.isLoading=!1,this.isBusy=!1),this.enableScrollEvents(!i)}async connectedCallback(){const i=u(this.el);i?(this.scrollEl=await f(i),this.thresholdChanged(),this.disabledChanged(),"top"===this.position&&e((()=>{this.scrollEl&&(this.scrollEl.scrollTop=this.scrollEl.scrollHeight-this.scrollEl.clientHeight)}))):p(this.el)}disconnectedCallback(){this.enableScrollEvents(!1),this.scrollEl=void 0}async complete(){const i=this.scrollEl;if(this.isLoading&&i&&(this.isLoading=!1,"top"===this.position)){this.isBusy=!0;const t=i.scrollHeight-i.scrollTop;requestAnimationFrame((()=>{o((()=>{const s=i.scrollHeight-t;requestAnimationFrame((()=>{e((()=>{i.scrollTop=s,this.isBusy=!1}))}))}))}))}}canStart(){return!(this.disabled||this.isBusy||!this.scrollEl||this.isLoading)}enableScrollEvents(i){this.scrollEl&&(i?this.scrollEl.addEventListener("scroll",this.onScroll):this.scrollEl.removeEventListener("scroll",this.onScroll))}render(){const i=c(this);return n(r,{class:{[i]:!0,"infinite-scroll-loading":this.isLoading,"infinite-scroll-enabled":!this.disabled}})}get el(){return l(this)}static get watchers(){return{threshold:["thresholdChanged"],disabled:["disabledChanged"]}}};b.style="ion-infinite-scroll{display:none;width:100%}.infinite-scroll-enabled{display:block}";const w=class{constructor(t){i(this,t)}componentDidLoad(){if(void 0===this.loadingSpinner){const i=c(this);this.loadingSpinner=d.get("infiniteLoadingSpinner",d.get("spinner","ios"===i?"lines":"crescent"))}}render(){const i=c(this);return n(r,{class:{[i]:!0,[`infinite-scroll-content-${i}`]:!0}},n("div",{class:"infinite-loading"},this.loadingSpinner&&n("div",{class:"infinite-loading-spinner"},n("ion-spinner",{name:this.loadingSpinner})),this.loadingText&&n("div",{class:"infinite-loading-text",innerHTML:g(this.loadingText)})))}};w.style={ios:"ion-infinite-scroll-content{display:flex;flex-direction:column;justify-content:center;min-height:84px;text-align:center;user-select:none}.infinite-loading{margin-left:0;margin-right:0;margin-top:0;margin-bottom:32px;display:none;width:100%}.infinite-loading-text{margin-left:32px;margin-right:32px;margin-top:4px;margin-bottom:0}@supports (margin-inline-start: 0) or (-webkit-margin-start: 0){.infinite-loading-text{margin-left:unset;margin-right:unset;-webkit-margin-start:32px;margin-inline-start:32px;-webkit-margin-end:32px;margin-inline-end:32px}}.infinite-scroll-loading ion-infinite-scroll-content>.infinite-loading{display:block}.infinite-scroll-content-ios .infinite-loading-text{color:var(--ion-color-step-600, #666666)}.infinite-scroll-content-ios .infinite-loading-spinner .spinner-lines-ios line,.infinite-scroll-content-ios .infinite-loading-spinner .spinner-lines-small-ios line,.infinite-scroll-content-ios .infinite-loading-spinner .spinner-crescent circle{stroke:var(--ion-color-step-600, #666666)}.infinite-scroll-content-ios .infinite-loading-spinner .spinner-bubbles circle,.infinite-scroll-content-ios .infinite-loading-spinner .spinner-circles circle,.infinite-scroll-content-ios .infinite-loading-spinner .spinner-dots circle{fill:var(--ion-color-step-600, #666666)}",md:"ion-infinite-scroll-content{display:flex;flex-direction:column;justify-content:center;min-height:84px;text-align:center;user-select:none}.infinite-loading{margin-left:0;margin-right:0;margin-top:0;margin-bottom:32px;display:none;width:100%}.infinite-loading-text{margin-left:32px;margin-right:32px;margin-top:4px;margin-bottom:0}@supports (margin-inline-start: 0) or (-webkit-margin-start: 0){.infinite-loading-text{margin-left:unset;margin-right:unset;-webkit-margin-start:32px;margin-inline-start:32px;-webkit-margin-end:32px;margin-inline-end:32px}}.infinite-scroll-loading ion-infinite-scroll-content>.infinite-loading{display:block}.infinite-scroll-content-md .infinite-loading-text{color:var(--ion-color-step-600, #666666)}.infinite-scroll-content-md .infinite-loading-spinner .spinner-lines-md line,.infinite-scroll-content-md .infinite-loading-spinner .spinner-lines-small-md line,.infinite-scroll-content-md .infinite-loading-spinner .spinner-crescent circle{stroke:var(--ion-color-step-600, #666666)}.infinite-scroll-content-md .infinite-loading-spinner .spinner-bubbles circle,.infinite-scroll-content-md .infinite-loading-spinner .spinner-circles circle,.infinite-scroll-content-md .infinite-loading-spinner .spinner-dots circle{fill:var(--ion-color-step-600, #666666)}"};
/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */
const y=(i,t)=>{const s=x(i,t);return s&&i.ownerDocument?i.ownerDocument.importNode(s.content,!0).children[0]:null},x=(i,t)=>{switch(t){case"item":return i.querySelector("template:not([name])");case"header":return i.querySelector("template[name=header]");case"footer":return i.querySelector("template[name=footer]")}},j=(i,t,s,n,e,o,l,r,h,a,c,d)=>{const u=[],p=d+c;for(let d=c;d<p;d++){const c=i[d];if(e){const t=e(c,d,i);null!=t&&u.push({i:a++,type:"header",value:t,index:d,height:s?s(t,d):l,reads:s?0:2,visible:!!s})}if(u.push({i:a++,type:"item",value:c,index:d,height:t?t(c,d):h,reads:t?0:2,visible:!!t}),o){const t=o(c,d,i);null!=t&&u.push({i:a++,type:"footer",value:t,index:d,height:n?n(t,d):r,reads:n?0:2,visible:!!n})}}return u},k=class{constructor(t){i(this,t),this.range={offset:0,length:0},this.viewportHeight=0,this.cells=[],this.virtualDom=[],this.isEnabled=!1,this.viewportOffset=0,this.currentScrollTop=0,this.indexDirty=0,this.lastItemLen=0,this.totalHeight=0,this.approxItemHeight=45,this.approxHeaderHeight=30,this.approxFooterHeight=30,this.onScroll=()=>{this.updateVirtualScroll()}}itemsChanged(){this.calcCells(),this.updateVirtualScroll()}componentWillLoad(){console.warn("[Deprecation Warning]: ion-virtual-scroll has been deprecated and will be removed in Ionic Framework v7.0. See https://ionicframework.com/docs/angular/virtual-scroll for migration steps.")}async connectedCallback(){const i=this.el.closest("ion-content");i?(this.scrollEl=await i.getScrollElement(),this.contentEl=i,this.calcCells(),this.updateState()):console.error("<ion-virtual-scroll> must be used inside an <ion-content>")}componentDidUpdate(){this.updateState()}disconnectedCallback(){this.scrollEl=void 0}onResize(){this.calcCells(),this.updateVirtualScroll()}positionForItem(i){return Promise.resolve(((i,t,s)=>{const n=t.find((t=>"item"===t.type&&t.index===i));return n?s[n.i]:-1})(i,this.cells,this.getHeightIndex()))}async checkRange(i,t=-1){if(!this.items)return;const s=-1===t?this.items.length-i:t,n=((i,t)=>0===t?0:t===(i.length>0?i[i.length-1].index:0)+1?i.length:i.findIndex((i=>i.index===t)))(this.cells,i),e=j(this.items,this.itemHeight,this.headerHeight,this.footerHeight,this.headerFn,this.footerFn,this.approxHeaderHeight,this.approxFooterHeight,this.approxItemHeight,n,i,s);this.cells=((i,t,s)=>{if(0===s&&t.length>=i.length)return t;for(let n=0;n<t.length;n++)i[n+s]=t[n];return i})(this.cells,e,n),this.lastItemLen=this.items.length,this.indexDirty=Math.max(i-1,0),this.scheduleUpdate()}async checkEnd(){this.items&&this.checkRange(this.lastItemLen)}updateVirtualScroll(){this.isEnabled&&this.scrollEl&&(this.timerUpdate&&(clearTimeout(this.timerUpdate),this.timerUpdate=void 0),o(this.readVS.bind(this)),e(this.writeVS.bind(this)))}readVS(){const{contentEl:i,scrollEl:t,el:s}=this;let n=0,e=s;for(;e&&e!==i;)n+=e.offsetTop,e=e.offsetParent;this.viewportOffset=n,t&&(this.viewportHeight=t.offsetHeight,this.currentScrollTop=t.scrollTop)}writeVS(){const i=this.indexDirty,t=(e=this.currentScrollTop-this.viewportOffset,o=this.viewportHeight,{top:Math.max(e-100,0),bottom:e+o+100}),s=this.getHeightIndex(),n=((i,t)=>{const s=t.top,n=t.bottom;let e=0;for(;e<i.length&&!(i[e]>s);e++);const o=Math.max(e-2-1,0);for(;e<i.length&&!(i[e]>=n);e++);return{offset:o,length:Math.min(e+2,i.length)-o}})(s,t);var e,o;((i,t,s)=>i<=s.offset+s.length||t.offset!==s.offset||t.length!==s.length)(i,this.range,n)&&(this.range=n,((i,t,s,n)=>{for(const t of i)t.change=0,t.d=!0;const e=[],o=n.offset+n.length;for(let l=n.offset;l<o;l++){const n=s[l],o=i.find((i=>i.d&&i.cell===n));if(o){const i=t[l];i!==o.top&&(o.top=i,o.change=1),o.d=!1}else e.push(n)}const l=i.filter((i=>i.d));for(const s of e){const n=l.find((i=>i.d&&i.cell.type===s.type)),e=s.i;n?(n.d=!1,n.change=2,n.cell=s,n.top=t[e]):i.push({d:!1,cell:s,visible:!0,change:2,top:t[e]})}i.filter((i=>i.d&&-9999!==i.top)).forEach((i=>{i.change=1,i.top=-9999}))})(this.virtualDom,s,this.cells,n),this.nodeRender?((i,t,s,n)=>{const e=Array.from(i.children).filter((i=>"TEMPLATE"!==i.tagName)),o=e.length;let l;for(let r=0;r<s.length;r++){const h=s[r],a=h.cell;if(2===h.change){if(r<o)l=e[r],t(l,a,r);else{const s=y(i,a.type);l=t(s,a,r)||s,l.classList.add("virtual-item"),i.appendChild(l)}l.$ionCell=a}else l=e[r];0!==h.change&&(l.style.transform=`translate3d(0,${h.top}px,0)`);const c=a.visible;h.visible!==c&&(c?l.classList.remove("virtual-loading"):l.classList.add("virtual-loading"),h.visible=c),a.reads>0&&(n(a,l),a.reads--)}})(this.el,this.nodeRender,this.virtualDom,this.updateCellHeight.bind(this)):this.domRender?this.domRender(this.virtualDom):this.renderItem&&h(this))}updateCellHeight(i,t){const s=()=>{if(t.$ionCell===i){const s=window.getComputedStyle(t),n=t.offsetHeight+parseFloat(s.getPropertyValue("margin-bottom"));this.setCellHeight(i,n)}};t?m(t,s):s()}setCellHeight(i,t){const s=i.i;i===this.cells[s]&&(i.height===t&&!0===i.visible||(i.visible=!0,i.height=t,this.indexDirty=Math.min(this.indexDirty,s),this.scheduleUpdate()))}scheduleUpdate(){clearTimeout(this.timerUpdate),this.timerUpdate=setTimeout((()=>this.updateVirtualScroll()),100)}updateState(){const i=!(!this.scrollEl||!this.cells);i!==this.isEnabled&&(this.enableScrollEvents(i),i&&this.updateVirtualScroll())}calcCells(){this.items&&(this.lastItemLen=this.items.length,this.cells=j(this.items,this.itemHeight,this.headerHeight,this.footerHeight,this.headerFn,this.footerFn,this.approxHeaderHeight,this.approxFooterHeight,this.approxItemHeight,0,0,this.lastItemLen),this.indexDirty=0)}getHeightIndex(){return this.indexDirty!==1/0&&this.calcHeightIndex(this.indexDirty),this.heightIndex}calcHeightIndex(i=0){this.heightIndex=((i,t)=>{if(!i)return new Uint32Array(t);if(i.length===t)return i;if(t>i.length){const s=new Uint32Array(t);return s.set(i),s}return i.subarray(0,t)})(this.heightIndex,this.cells.length),this.totalHeight=((i,t,s)=>{let n=i[s];for(let e=s;e<i.length;e++)i[e]=n,n+=t[e].height;return n})(this.heightIndex,this.cells,i),this.indexDirty=1/0}enableScrollEvents(i){this.rmEvent&&(this.rmEvent(),this.rmEvent=void 0);const t=this.scrollEl;t&&(this.isEnabled=i,t.addEventListener("scroll",this.onScroll),this.rmEvent=()=>{t.removeEventListener("scroll",this.onScroll)})}renderVirtualNode(i){const{type:t,value:s,index:n}=i.cell;switch(t){case"item":return this.renderItem(s,n);case"header":return this.renderHeader(s,n);case"footer":return this.renderFooter(s,n)}}render(){return n(r,{style:{height:`${this.totalHeight}px`}},this.renderItem&&n(C,{dom:this.virtualDom},this.virtualDom.map((i=>this.renderVirtualNode(i)))))}get el(){return l(this)}static get watchers(){return{itemHeight:["itemsChanged"],headerHeight:["itemsChanged"],footerHeight:["itemsChanged"],items:["itemsChanged"]}}},C=({dom:i},t,s)=>s.map(t,((t,s)=>{const n=i[s],e=t.vattrs||{};let o=e.class||"";return o+="virtual-item ",n.visible||(o+="virtual-loading"),Object.assign(Object.assign({},t),{vattrs:Object.assign(Object.assign({},e),{class:o,style:Object.assign(Object.assign({},e.style),{transform:`translate3d(0,${n.top}px,0)`})})})}));k.style="ion-virtual-scroll{display:block;position:relative;width:100%;contain:strict;user-select:none}ion-virtual-scroll>.virtual-loading{opacity:0}ion-virtual-scroll>.virtual-item{position:absolute !important;top:0 !important;right:0 !important;left:0 !important;transition-duration:0ms;will-change:transform}";export{v as fireenjin_pagination,b as ion_infinite_scroll,w as ion_infinite_scroll_content,k as ion_virtual_scroll}
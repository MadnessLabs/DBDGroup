import{r as i,d as t,B as s,h as n,H as o}from"./p-a77c936b.js";import{D as e}from"./p-0506e1ca.js";import"./p-4e9b4087.js";const l=class{constructor(s){i(this,s),this.fireenjinFetch=t(this,"fireenjinFetch",7),this.disablePageCheck=!1,this.disableFetch=!1,this.display="list",this.page=0,this.results=[],this.loadingSpinner="bubbles",this.loadingText="Loading more data...",this.name="pagination",this.disableVirtualScroll=!1,this.removeDuplicates=!1,this.paramData={}}onQuery(){this.infiniteScrollEl.disabled=!1,this.results=[],this.getResults({page:0})}onOrderBy(){this.results=[],this.infiniteScrollEl.disabled=!1,this.getResults({page:0})}onDisplay(){this.infiniteScrollEl.disabled=!1,setTimeout((async()=>{window.dispatchEvent(new window.Event("resize"))}),2e3)}async onSuccess(i){if(i.detail.name===this.name){let t=[];try{t=this.resultsKey.split(".").reduce(((i,t)=>i[t]),i.detail.data)}catch(t){console.log("Error getting results",i.detail,this.resultsKey)}try{0===this.page&&(this.results=[]),this.page=this.pageKey?this.pageKey.split(".").reduce(((i,t)=>i[t]),i.detail.data):this.page+1,await this.addResults(t)}catch(i){console.log("Error updating results!")}await this.infiniteScrollEl.complete(),(!(null==t?void 0:t.length)||this.pageCountKey&&this.pageKey&&this.pageKey.split(".").reduce(((i,t)=>i[t]),i.detail.data)===this.pageCountKey.split(".").reduce(((i,t)=>i[t]),i.detail.data))&&(this.infiniteScrollEl.disabled=!0),this.disableVirtualScroll||(await this.virtualScrollEl.checkEnd(),setTimeout((()=>{window.dispatchEvent(new window.Event("resize"))}),200))}}onInfiniteScroll(){this.getResults({next:!0})}onResize(){var i,t;if(!this.disableVirtualScroll)if("list"===this.display&&(null===(i=this.virtualScrollEl)||void 0===i?void 0:i.querySelector("ion-item")))this.approxItemHeight=this.virtualScrollEl.querySelector("ion-item").offsetHeight;else if("grid"===this.display&&(null===(t=this.virtualScrollEl)||void 0===t?void 0:t.querySelectorAll("ion-col"))){let i,t;const s=this.virtualScrollEl.querySelectorAll("ion-col");for(i=0;i<s.length;i++){const n=s[i];if(t&&n.offsetTop!==t.offsetTop)break;t=n}t&&t.firstChild&&(this.approxItemHeight=t.firstChild.scrollHeight/i+18)}}async clearParamData(i){if(i&&this.paramData[i]){const t=this.paramData;delete t[i],this.paramData=t}else i||(this.paramData={});return this.infiniteScrollEl.disabled=!1,this.paramData}async addResults(i=[]){if(this.removeDuplicates){const t=i.map((i=>i.id));this.results=[...this.results.filter((i=>!t.includes(i.id))),...i]}else this.results=[...this.results,...i];this.infiniteScrollEl.disabled=!1}async clearResults(){this.page=0,this.results=[],this.infiniteScrollEl.disabled=!1}async getResults(i={}){var t,s,n;(this.disablePageCheck||(null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.pathname)===this.initailizedOnPath)&&((i.page||0===i.page)&&(this.page=i.page),i.next&&(this.page=this.page+1),this.paramData=Object.assign(Object.assign(Object.assign({},this.paramData),{limit:i.limit?i.limit:this.limit,orderBy:this.orderBy,orderDirection:this.orderDirection,page:this.page}),(null==i?void 0:i.paramData)?i.paramData:{}),(this.query||""===this.query)&&(this.paramData.query=this.query),0===this.page&&(this.paramData.next=null,this.paramData.back=null),i.next&&(null===(s=this.results)||void 0===s?void 0:s.length)&&(null===(n=this.results[this.results.length-1])||void 0===n?void 0:n.id)&&(this.paramData.next=this.results[this.results.length-1].id),this.fireenjinFetch.emit({name:this.name,endpoint:this.endpoint,dataPropsMap:this.dataPropsMap?this.dataPropsMap:null,disableFetch:this.disableFetch,params:Object.assign(Object.assign({},this.fetchParams?this.fetchParams:{}),{data:Object.assign(Object.assign({},this.fetchData?this.fetchData:{}),this.paramData)})}))}componentWillLoad(){(null==s?void 0:s.isBrowser)&&this.collection&&(this.resultsKey=this.resultsKey?this.resultsKey:`${this.collection}.results`,this.pageKey=this.pageKey?this.pageKey:`${this.collection}.page`,this.pageCountKey=this.pageCountKey?this.pageCountKey:`${this.collection}.pageCount`,this.resultCountKey=this.resultCountKey?this.resultCountKey:`${this.collection}.resultCount`,this.name=this.name?this.name:`${this.collection}Pagination`)}componentDidLoad(){var i,t;(null==s?void 0:s.isBrowser)&&((null===(i=null===window||void 0===window?void 0:window.location)||void 0===i?void 0:i.pathname)&&(this.initailizedOnPath=window.location.pathname),this.disableVirtualScroll||(window.dispatchEvent(new window.Event("resize")),this.resizeInterval=setInterval((()=>{window.dispatchEvent(new window.Event("resize"))}),3e3)),(null===(t=this.results)||void 0===t?void 0:t.length)||this.getResults())}disconnectedCallback(){this.disableVirtualScroll||clearInterval(this.resizeInterval)}renderResults(){return"grid"===this.display?n("ion-grid",null,n("ion-row",null,this.results.map((i=>"string"==typeof this.gridEl({result:i},null,null)?n("ion-col",{innerHTML:this.gridEl({result:i},null,null)}):n("ion-col",null,this.gridEl({result:i},null,null)))))):this.listEl?n("ion-card",null,n("ion-list",null,this.results.map((i=>"string"==typeof this.listEl({result:i},null,null)?n("div",{innerHTML:this.listEl({result:i},null,null)}):this.listEl({result:i},null,null))))):this.results.map(((i,t)=>this.renderItem(i,t)))}render(){return n("div",{class:"pagination"},this.disableVirtualScroll?n("div",null,this.renderResults()):n("ion-virtual-scroll",{items:this.results,approxItemHeight:this.approxItemHeight,renderItem:this.renderItem,ref:i=>this.virtualScrollEl=i},(this.listEl||this.gridEl)&&this.renderResults()),n("ion-infinite-scroll",{style:{display:"block"},ref:i=>this.infiniteScrollEl=i},n("ion-infinite-scroll-content",{"loading-spinner":this.loadingSpinner,"loading-text":this.loadingText})))}static get watchers(){return{query:["onQuery"],orderBy:["onOrderBy"],display:["onDisplay"]}}};(function(i,t,s,n){var o,e=arguments.length,l=e<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(i,t,s,n);else for(var r=i.length-1;r>=0;r--)(o=i[r])&&(l=(e<3?o(l):e>3?o(t,s,l):o(t,s))||l);e>3&&l&&Object.defineProperty(t,s,l)})([e(1e3)],l.prototype,"onQuery",null),l.style="";const r=class{constructor(s){i(this,s),this.fireenjinTrigger=t(this,"fireenjinTrigger",7),this.modeToggle=!1,this.displayMode="grid",this.disabled=!1,this.showFilter=!0,this.currentFilters={}}onFilterChange(){this.updateCurrentFilters()}async onTrigger(i){var t,s,n,o,e,l,r,h,a,d,c,u,v;if("set"===(null===(t=null==i?void 0:i.detail)||void 0===t?void 0:t.name)&&(null===(n=null===(s=null==i?void 0:i.detail)||void 0===s?void 0:s.payload)||void 0===n?void 0:n.name)){for(const[t,s]of this.filters.entries()){if(!(null==s?void 0:s.name)||(null===(e=null===(o=null==i?void 0:i.detail)||void 0===o?void 0:o.payload)||void 0===e?void 0:e.name)!==(null==s?void 0:s.name))continue;const n=Object.assign(Object.assign({},s),{value:(null===(r=null===(l=null==i?void 0:i.detail)||void 0===l?void 0:l.payload)||void 0===r?void 0:r.value)||null});this.filters[t]=n,this.currentFilters[s.name]=n,this.filters=[...this.filters],this.paginationEl&&!(null===(h=this.paginationEl)||void 0===h?void 0:h.disableFetch)&&(this.paginationEl.fetchData=Object.assign(Object.assign({},(null===(a=this.paginationEl)||void 0===a?void 0:a.fetchData)||{}),{[s.name]:null===(c=null===(d=null==i?void 0:i.detail)||void 0===d?void 0:d.payload)||void 0===c?void 0:c.value}))}if(!(null===(u=this.paginationEl)||void 0===u?void 0:u.clearResults)||!(null===(v=this.paginationEl)||void 0===v?void 0:v.getResults))return;await this.paginationEl.clearResults(),await this.paginationEl.getResults()}}async onChange(i){var t,s,n;(null===(t=this.paginationEl)||void 0===t?void 0:t.clearParamData)&&("orderBy"===(null===(s=null==i?void 0:i.target)||void 0===s?void 0:s.name)&&(this.paginationEl.orderBy=i.detail.value),"ION-SEARCHBAR"===(null===(n=null==i?void 0:i.target)||void 0===n?void 0:n.tagName)&&(await this.paginationEl.clearParamData("next"),await this.paginationEl.clearParamData("back"),await this.paginationEl.clearParamData("page"),this.paginationEl.query=i.detail.value||""))}async togglePaginationDisplay(){this.displayMode="grid"===this.displayMode?"list":"grid",this.paginationEl.display=this.displayMode}async clearFilter(i,t){var s,n,o,e,l;i.preventDefault(),i.stopPropagation();const r=(null===(s=this.paginationEl)||void 0===s?void 0:s.fetchData)||{};for(const[i,s]of this.filters.entries())s.name&&s.value&&s.name===t.name&&(this.filters[i]=Object.assign(Object.assign({},s),{value:null}),delete this.currentFilters[t.name],r[s.name]&&delete r[s.name],this.filters=[...this.filters],(null===(n=this.paginationEl)||void 0===n?void 0:n.clearParamData)&&await this.paginationEl.clearParamData(s.name));const h={};for(const i of Object.values(this.currentFilters))h[i.name]=i.value;this.fireenjinTrigger.emit({event:i,name:"set",payload:{name:t.name,value:null}});let a={paramData:h};this.beforeGetResults&&"function"==typeof this.beforeGetResults&&(a=await this.beforeGetResults(a)),this.paginationEl&&!(null===(o=this.paginationEl)||void 0===o?void 0:o.disableFetch)&&(this.paginationEl.fetchData=r),(null===(e=this.paginationEl)||void 0===e?void 0:e.clearResults)&&await this.paginationEl.clearResults(),(null===(l=this.paginationEl)||void 0===l?void 0:l.getResults)&&await this.paginationEl.getResults(a)}async updateCurrentFilters(){if(this.filters)for(const i of this.filters)(null==i?void 0:i.value)&&(this.currentFilters[i.name]=i,this.currentFilters=Object.assign({},this.currentFilters))}getLabelForValue(i,t){for(const s of(null==i?void 0:i.options)||[])if((null==s?void 0:s.value)===t)return(null==s?void 0:s.label)?s.label:s.value}getControlLabel(i){const t=(null==i?void 0:i.value)?i.value:null;return t?Array.isArray(t)?t.map((t=>this.getLabelForValue(i,t))).join(", "):this.getLabelForValue(i,t):i.label}componentDidLoad(){(null==s?void 0:s.isBrowser)&&this.updateCurrentFilters()}render(){var i,t,s;return n(o,null,n("div",{class:"search-bar-wrapper"},n("ion-searchbar",{disabled:this.disabled}),n("div",{class:"chip-bowl"},this.showFilter&&(null===(i=this.filters)||void 0===i?void 0:i.length)&&this.filters.map((i=>{var t,s,o,e;return n("ion-chip",{outline:!(null===(s=null===(t=this.currentFilters)||void 0===t?void 0:t[null==i?void 0:i.name])||void 0===s?void 0:s.value),onClick:t=>this.fireenjinTrigger.emit({event:t,name:"filter",payload:{control:i}})},(null==i?void 0:i.icon)&&n("ion-icon",{name:i.icon}),(null==i?void 0:i.label)&&n("ion-label",null,this.getControlLabel(i)),(null===(e=null===(o=this.currentFilters)||void 0===o?void 0:o[null==i?void 0:i.name])||void 0===e?void 0:e.value)&&n("ion-icon",{name:"close-circle",onClick:t=>this.clearFilter(t,i)}))})))),(null===(t=this.filters)||void 0===t?void 0:t.length)&&n("ion-button",{onClick:()=>this.showFilter=!this.showFilter,class:"filter-button",size:"small",fill:"clear",shape:"round",style:{color:"var(--ion-text-color)"}},n("ion-icon",{name:"funnel",slot:"icon-only"}),(null===(s=Object.keys(this.currentFilters))||void 0===s?void 0:s.length)&&n("ion-badge",{slot:"end"},this.currentFilters?Object.keys(this.currentFilters).length:0)))}static get watchers(){return{filters:["onFilterChange"]}}};r.style="fireenjin-search-bar{display:block;border:1px solid rgba(var(--ion-text-color-rgb), 0.6);border-radius:26px;position:relative;padding:5px 0}fireenjin-search-bar .search-bar-wrapper{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:space-between;align-content:center}fireenjin-search-bar .chip-bowl{display:inline-flex;flex-wrap:nowrap;overflow-x:auto;overflow-y:hidden;align-content:center;margin:auto 10px auto auto;max-width:100%;padding-bottom:3px}fireenjin-search-bar .chip-bowl::-webkit-scrollbar{height:5px}fireenjin-search-bar .chip-bowl::-webkit-scrollbar-thumb{background:rgba(var(--ion-text-color-rgb), 0.6);border-radius:2px}fireenjin-search-bar .chip-bowl ion-chip{margin:auto 10px;border-color:rgba(var(--ion-text-color-rgb), 0.8);opacity:0.8}fireenjin-search-bar .chip-bowl ion-chip:hover{opacity:1}fireenjin-search-bar .chip-bowl ion-chip ion-icon{color:var(--ion-text-color);display:inline-block;opacity:0.6;height:20px;width:20px}fireenjin-search-bar .chip-bowl ion-chip:last-of-type{margin-right:50px}fireenjin-search-bar .filter-button{order:2;margin:auto 0;position:absolute;right:0px;top:12px}fireenjin-search-bar .filter-button ion-badge{border-radius:100%;font-size:8px;height:12px;width:12px;padding:2px}fireenjin-search-bar ion-searchbar{max-width:250px;padding-top:2px !important;padding-bottom:0px !important;--background:transparent !important;--box-shadow:none !important;--color:var(--ion-text-color) !important}fireenjin-search-bar .searchbar-input{padding-inline-end:65px !important;padding-inline-start:42px !important}fireenjin-search-bar .searchbar-search-icon{left:10px !important}@media only screen and (max-width: 500px){fireenjin-search-bar .filter-button ion-label{display:none}fireenjin-search-bar .search-bar-wrapper{padding-right:0}}";export{l as fireenjin_pagination,r as fireenjin_search_bar}